<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Magic Animal Holes</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Favicon and PWA Meta Tags -->
  <link rel="icon" type="image/png" href="index.png">
  <link rel="apple-touch-icon" href="index.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Magic Animal Holes">
  <meta name="theme-color" content="#667eea">
  <meta name="msapplication-TileImage" content="index.png">
  <meta name="msapplication-TileColor" content="#667eea">
  <link rel="manifest" href="manifest.json">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    body {
      font-family: 'Arial', 'Arial', cursive;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
      touch-action: manipulation;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* Ad Banner Styles */
    .ad-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff6b6b);
      background-size: 400% 400%;
      color: white;
      text-align: center;
      padding: 12px 15px;
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      font-weight: bold;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      animation: gradientShift 3s ease infinite;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .ad-banner .ad-emoji {
      font-size: 1.2em;
    }

    .ad-banner .ad-text {
      flex: 1;
    }

    .ad-banner .ad-close {
      background: rgba(255, 255, 255, 0.3);
      border: none;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9em;
      cursor: pointer;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .screen {
      display: none;
      width: 100%;
      min-height: 100vh;
      padding: 10px;
      padding-top: 60px; /* Space for ad banner */
    }

    .screen.active {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #welcomeScreen {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 50%, #48dbfb 100%);
    }

    .welcome-title {
      font-size: clamp(2.5rem, 8vw, 4rem);
      color: white;
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
    }

    .welcome-subtitle {
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      color: white;
      text-align: center;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .choose-title {
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      color: white;
      text-align: center;
      margin: 20px 0;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
      background: rgba(255, 255, 255, 0.3);
      padding: 15px 30px;
      border-radius: 25px;
      border: 3px solid white;
    }

    .difficulty-selector,
    .character-selector {
      width: 90%;
      max-width: 500px;
      margin: 20px 0;
    }

    .dropdown-container {
      position: relative;
      width: 100%;
    }

    .dropdown-header {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      border-radius: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      border: 3px solid #FFD700;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .selected-difficulty,
    .selected-character {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .selected-emoji {
      font-size: clamp(2rem, 6vw, 2.5rem);
    }
    
    .selected-name {
      color: #333;
      font-weight: bold;
    }

    .dropdown-arrow {
      font-size: 1.5em;
      transition: transform 0.3s ease;
    }

    .dropdown-arrow.open {
      transform: rotate(180deg);
    }

    .dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 15px;
      margin-top: 5px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      z-index: 1000;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .dropdown-list.open {
      max-height: 400px;
      overflow-y: auto;
    }

    .difficulty-option,
    .character-option {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 1px solid #eee;
    }

    .difficulty-option:last-child,
    .character-option:last-child {
      border-bottom: none;
    }

    .difficulty-option:hover,
    .character-option:hover {
      background: #f0f0f0;
    }

    .difficulty-option .emoji,
    .character-option .emoji {
      font-size: 1.8em;
      margin-right: 15px;
      width: 40px;
      text-align: center;
    }

    .difficulty-option .name,
    .character-option .name {
      font-size: 1.1em;
      color: #333;
      font-weight: bold;
      flex: 1;
    }

    .start-game-btn {
      background: linear-gradient(45deg, #00b894, #00ced1);
      border: none;
      padding: 20px 50px;
      border-radius: 50px;
      font-size: clamp(1.3rem, 4vw, 1.8rem);
      color: white;
      cursor: pointer;
      font-family: arial;
      font-weight: bold;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      margin-top: 30px;
    }

    .start-game-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #gameScreen {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .game-header {
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
    }

    .game-title {
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      color: white;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.3);
      margin-bottom: 15px;
    }
    
    .target-animal {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      border: 4px solid #FF6B6B;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 400px;
      animation: pulseTarget 2s infinite;
    }

    .target-title {
      font-size: clamp(1.3rem, 4vw, 1.7rem);
      color: #FF6B6B;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .target-display {
      font-size: clamp(4rem, 12vw, 6rem);
      animation: glow 1.5s infinite;
      margin: 10px 0;
    }

    .game-info {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      width: 90%;
      max-width: 400px;
    }

    .info-box {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      font-size: clamp(1rem, 4vw, 1.3rem);
      font-weight: bold;
    }

    .time-left {
      color: #e17055;
    }

    .score {
      color: #00b894;
    }

    .holes-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 25px;
      max-width: 500px;
      width: 90%;
      margin-left: auto;
      margin-right: auto;
    }

    .hole {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      cursor: pointer;
    }

    .hole::before {
      content: '';
      position: absolute;
      width: 80%;
      height: 80%;
      background: #8b4513;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: inset 0 -8px 15px rgba(0, 0, 0, 0.5);
      border: 6px solid #5d4037;
    }

    .animal {
      position: absolute;
      width: 70%;
      height: 70%;
      background: white;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.5em;
      transition: all 0.4s ease;
      z-index: 2;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 3px solid #ffd700;
    }

    .animal.pop-up {
      transform: translate(-50%, -100%) scale(1);
      animation: popUp 0.5s ease-out;
    }

    .animal.hit {
      animation: hitAnimation 0.4s ease;
      background: #ffeb3b;
    }

    .animal.wrong {
      animation: wrongHit 0.4s ease;
      background: #ff6b6b;
      border-color: #ff4757;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 400px;
      width: 90%;
      margin: 0 auto;
    }

    .control-btn {
      background: linear-gradient(45deg, #00b894, #00ced1);
      border: none;
      padding: 15px;
      border-radius: 20px;
      font-size: clamp(1rem, 3vw, 1.2rem);
      color: white;
      cursor: pointer;
      font-family: arial;
      font-weight: bold;
    }

    .game-over {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
    }

    .game-over-content {
      background: linear-gradient(135deg, #ff6b6b, #ff8e53);
      padding: 30px;
      border-radius: 25px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      color: white;
    }

    .final-score {
      font-size: clamp(2.5rem, 10vw, 4rem);
      color: #ffd700;
      margin: 20px 0;
    }

    @keyframes glow {
      0%,
      100% {
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      }
      50% {
        text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
      }
    }

    @keyframes popUp {
      0% {
        transform: translate(-50%, -50%) scale(0);
      }
      70% {
        transform: translate(-50%, -120%) scale(1.1);
      }
      100% {
        transform: translate(-50%, -100%) scale(1);
      }
    }

    @keyframes hitAnimation {
      0% {
        transform: translate(-50%, -100%) scale(1);
      }
      50% {
        transform: translate(-50%, -100%) scale(1.3);
      }
      100% {
        transform: translate(-50%, -100%) scale(0);
      }
    }

    @keyframes wrongHit {
      0% {
        transform: translate(-50%, -100%) scale(1);
      }
      25% {
        transform: translate(-50%, -100%) scale(1.2) rotate(-5deg);
      }
      50% {
        transform: translate(-50%, -100%) scale(1.2) rotate(5deg);
      }
      100% {
        transform: translate(-50%, -100%) scale(0);
      }
    }

    @media (max-width: 480px) {
      .controls {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- Ad Banner -->
  <div class="ad-banner" id="adBanner">
    <span class="ad-emoji">ğŸ‘‰</span>
    <span class="ad-text">Î Î¬Ï„Î·ÏƒÎµ ÎºÎ»Î¹Îº ÎºÎ±Î¹ Î²Î¿Î®Î¸Î·ÏƒÎ­ Î¼Î±Ï‚ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎ¿Ï…Î¼Îµ!</span>
    <button class="ad-close" id="adClose">âœ•</button>
  </div>

  <div class="screen active" id="welcomeScreen">
    <h1 class="welcome-title">Magic Animal Holes!</h1>

    <h2 class="choose-title">ğŸ¯ Î”Î¹Î¬Î»ÎµÎ¾Îµ Î”Ï…ÏƒÎºÎ¿Î»Î¯Î±!</h2>

    <div class="difficulty-selector">
      <div class="dropdown-container">
        <div class="dropdown-header" id="difficultyDropdownHeader">
          <div class="selected-difficulty">
            <span class="selected-name" id="selectedDifficultyName">Î•Ï€Î­Î»ÎµÎ¾Îµ Î´Ï…ÏƒÎºÎ¿Î»Î¯Î±...</span>
          </div>
          <span class="dropdown-arrow">â–¼</span>
        </div>
        <div class="dropdown-list" id="difficultyDropdownList"></div>
      </div>
    </div>

    <h2 class="choose-title">ğŸ¯ Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï„Î¿ Î–Ï‰Î¬ÎºÎ¹!</h2>

    <div class="character-selector">
      <div class="dropdown-container">
        <div class="dropdown-header" id="dropdownHeader">
          <div class="selected-character">
            <span class="selected-emoji">ğŸµ</span>
            <span class="selected-name">Î•Ï€Î­Î»ÎµÎ¾Îµ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎ±...</span>
          </div>
          <span class="dropdown-arrow">â–¼</span>
        </div>
        <div class="dropdown-list" id="dropdownList"></div>
      </div>
    </div>

    <button class="start-game-btn" id="startGameBtn" disabled>ğŸš€ ÎˆÎ½Î±ÏÎ¾Î· Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï</button>
  </div>

  <div class="screen" id="gameScreen">
    <div class="game-header">
      <h1 class="game-title">Î Î¿Î»Î»Î¿Î¯ Î§Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚! ğŸ¯</h1>
    </div>

    <div class="target-animal">
      <div class="target-title">ğŸ¯ Î£Ï„ÏŒÏ‡Î¿Ï‚:</div>
      <div class="target-display" id="targetAnimal">ğŸµ</div>
      <div>+<span id="targetPoints">10</span> Î ÏŒÎ½Ï„Î¿Î¹ Î±Î½Î¬ Ï‡Ï„ÏÏ€Î·Î¼Î±</div>
    </div>

    <div class="game-info">
      <div class="info-box time-left">â° Î§ÏÏŒÎ½Î¿Ï‚: <span id="timeLeft">60</span></div>
      <div class="info-box score">â­ Score: <span id="score">0</span></div>
    </div>

    <div class="holes-container" id="holesContainer"></div>

    <div class="controls">
      <button class="control-btn" onclick="restartGame()">ğŸ”„ ÎÎ­Î¿ Î Î±Î¹Ï‡Î½Î¯Î´Î¹</button>
      <button class="control-btn" onclick="showWelcomeScreen()">ğŸ  Î‘ÏÏ‡Î¹ÎºÎ®</button>
    </div>
  </div>

  <div class="game-over" id="gameOver">
    <div class="game-over-content">
      <h2>ğŸ¯ Î¤Î­Î»Î¿Ï‚ Î Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï!</h2>
      <div class="final-score" id="finalScore">0</div>
      
      <p id="gameMessage"></p>
      
      <div class="controls">
        <button class="control-btn" onclick="restartGame()">ğŸ® Î Î±Î¯Î¾Îµ ÎÎ±Î½Î¬</button>
        <button class="control-btn" onclick="showWelcomeScreen()">ğŸ  Î‘ÏÏ‡Î¹ÎºÎ®</button>
      </div>
    </div>
  </div>

  <script>
    const config = {
      difficulties: {
        easy: {
          name: 'Î•ÏÎºÎ¿Î»Î¿',
          emoji: 'ğŸŸ¢',
          time: 60, // 1 Î»ÎµÏ€Ï„ÏŒ
          animalSpeed: 5000, // Î“ÏÎ®Î³Î¿ÏÎ· ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·
          animalVisible: 5000,
          charactersAtOnce: 4 // 4 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±
        },
        medium: {
          name: 'ÎœÎ­Ï„ÏÎ¹Î¿',
          emoji: 'ğŸŸ¡',
          time: 60, // 45 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
          animalSpeed: 3500,
          animalVisible: 3500,
          charactersAtOnce: 4 // 4 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±
        },
        hard: {
          name: 'Î”ÏÏƒÎºÎ¿Î»Î¿',
          emoji: 'ğŸ”´',
          time: 60, // 30 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
          animalSpeed: 2000,
          animalVisible: 2000,
          charactersAtOnce: 4 // 4 Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÎµÏ‚ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î± (ÏŒÎ»ÎµÏ‚ Î¿Î¹ Ï„ÏÏÏ€ÎµÏ‚)
        }
      },
      animals: [{
          emoji: 'ğŸµ',
          name: 'ÎœÎ±ÏŠÎ¼Î¿Ï',
          points: 10
        },
        {
          emoji: 'ğŸ¦Š',
          name: 'Î‘Î»ÎµÏ€Î¿Ï',
          points: 7
        },
        {
          emoji: 'ğŸ¦„',
          name: 'ÎœÎ¿Î½ÏŒÎºÎµÏÎ¿Ï‚',
          points: 15
        },
        {
          emoji: 'ğŸ¦',
          name: 'Î›Î¹Î¿Î½Ï„Î¬ÏÎ¹',
          points: 12
        },
        {
          emoji: 'ğŸ¼',
          name: 'Î Î¬Î½Ï„Î±',
          points: 8
        },
        {
          emoji: 'ğŸ¬',
          name: 'Î”ÎµÎ»Ï†Î¯Î½Î¹',
          points: 9
        },
        {
          emoji: 'ğŸ¶',
          name: 'Î£ÎºÏÎ»Î¿Ï‚',
          points: 6
        },
        {
          emoji: 'ğŸ±',
          name: 'Î“Î¬Ï„Î±',
          points: 5
        },
        {
          emoji: 'ğŸ°',
          name: 'ÎšÎ¿Ï…Î½Î­Î»Î¹',
          points: 4
        },
        {
          emoji: 'ğŸ»',
          name: 'Î‘ÏÎºÎ¿ÏÎ´Î±',
          points: 11
        },
        {
          emoji: 'ğŸ¯',
          name: 'Î¤Î¯Î³ÏÎ·',
          points: 13
        },
        {
          emoji: 'ğŸ¨',
          name: 'Koala',
          points: 8
        },
        {
          emoji: 'ğŸ¹',
          name: 'Î§Î±Î¼ÏƒÏ„ÎµÏ',
          points: 5
        },
        {
          emoji: 'ğŸ¦',
          name: 'Î¡Î±ÎºÎ¿ÏÎ½',
          points: 9
        },
        {
          emoji: 'ğŸ¿ï¸',
          name: 'Î£ÎºÎ¯Î¿Ï…ÏÎ¿Ï‚',
          points: 6
        },
        {
          emoji: 'ğŸ¦¥',
          name: 'Î’ÏÎ±Î´ÏÏ€Î¿Ï…Ï‚',
          points: 14
        },
        {
          emoji: 'ğŸ¦¦',
          name: 'Î’Î¯Î´ÏÎ±',
          points: 11
        },
        {
          emoji: 'ğŸ¾',
          name: 'Capybara',
          points: 16
        }
      ]
    };
    let selectedAnimal = null;
    let selectedDifficulty = null;
    let currentTargetAnimal = null;
    let score = 0;
    let timeLeft = 60;
    let timer;
    let gameStarted = false;
    let activeAnimals = [];
    let animalInterval;
    let dropdownOpen = {
      difficulty: false,
      character: false
    };
    let gamesPlayed = 0;

    // Sound objects
    const correctSound = new Audio('https://www.soundboard.com/media/2405');
    const wrongSound = new Audio('https://www.soundboard.com/media/2529');

    // Ad banner functionality
    function initializeAdBanner() {
      const adBanner = document.getElementById('adBanner');
      const adClose = document.getElementById('adClose');
      
      // Show ad banner
      adBanner.style.display = 'flex';
      
      // Close button functionality
      adClose.addEventListener('click', function(e) {
        e.stopPropagation();
        adBanner.style.display = 'none';
      });
      
      // Banner click functionality
      adBanner.addEventListener('click', function() {
        // Load ad script
        (function(s){s.dataset.zone='9981373',s.src='https://groleegni.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')));
        
        // Hide banner after click
        adBanner.style.display = 'none';
      });
    }

    function initializeDropdowns() {
      // Initialize Difficulty Dropdown
      const difficultyList = document.getElementById('difficultyDropdownList');
      const difficultyNames = {
        easy: 'Î•ÏÎºÎ¿Î»Î¿',
        medium: 'ÎœÎ­Ï„ÏÎ¹Î¿',
        hard: 'Î”ÏÏƒÎºÎ¿Î»Î¿'
      };
      const difficultyEmojis = {
        easy: 'ğŸŸ¢',
        medium: 'ğŸŸ¡',
        hard: 'ğŸ”´'
      };
      
      Object.keys(config.difficulties).forEach(key => {
        const option = document.createElement('div');
        option.className = 'difficulty-option';
        option.innerHTML = `
          <span class="emoji">${difficultyEmojis[key]}</span>
          <span class="name">${difficultyNames[key]}</span>
        `;
        option.addEventListener('click', () => {
          selectDifficulty(key);
          toggleDropdown('difficulty');
        });
        difficultyList.appendChild(option);
      });

      document.getElementById('difficultyDropdownHeader').addEventListener('click', () => toggleDropdown('difficulty'));

      // Initialize Character Dropdown
      const characterList = document.getElementById('dropdownList');
      config.animals.forEach(animal => {
        const option = document.createElement('div');
        option.className = 'character-option';
        option.innerHTML = `
          <span class="emoji">${animal.emoji}</span>
          <span class="name">${animal.name}</span>
        `;
        option.addEventListener('click', () => {
          selectAnimal(animal);
          toggleDropdown('character');
        });
        characterList.appendChild(option);
      });
      document.getElementById('dropdownHeader').addEventListener('click', () => toggleDropdown('character'));

      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.difficulty-selector')) closeDropdown('difficulty');
        if (!e.target.closest('.character-selector')) closeDropdown('character');
      });
    }

    function toggleDropdown(type) {
      const list = type === 'difficulty' ? document.getElementById('difficultyDropdownList') : document.getElementById('dropdownList');
      const arrow = type === 'difficulty' ? document.querySelector('.difficulty-selector .dropdown-arrow') : document.querySelector('.character-selector .dropdown-arrow');
      
      dropdownOpen[type] = !dropdownOpen[type];
      list.classList.toggle('open', dropdownOpen[type]);
      arrow.classList.toggle('open', dropdownOpen[type]);
    }

    function closeDropdown(type) {
      if (dropdownOpen[type]) {
        const list = type === 'difficulty' ? document.getElementById('difficultyDropdownList') : document.getElementById('dropdownList');
        const arrow = type === 'difficulty' ? document.querySelector('.difficulty-selector .dropdown-arrow') : document.querySelector('.character-selector .dropdown-arrow');
        dropdownOpen[type] = false;
        list.classList.remove('open');
        arrow.classList.remove('open');
      }
    }

    function selectDifficulty(difficulty) {
      selectedDifficulty = difficulty;
      const difficultyInfo = config.difficulties[difficulty];
      document.getElementById('selectedDifficultyName').textContent = difficultyInfo.name;
      checkStartButton();
    }

    function selectAnimal(animal) {
      selectedAnimal = animal;
      document.querySelector('.selected-emoji').textContent = animal.emoji;
      document.querySelector('.selected-name').textContent = animal.name;
      document.querySelector('.selected-name').style.color = '#333';
      checkStartButton();
    }

    function checkStartButton() {
      document.getElementById('startGameBtn').disabled = !(selectedAnimal && selectedDifficulty);
    }

    function showWelcomeScreen() {
      document.getElementById('welcomeScreen').classList.add('active');
      document.getElementById('gameScreen').classList.remove('active');
      document.getElementById('gameOver').style.display = 'none';
      stopGame();
      closeDropdown('difficulty');
      closeDropdown('character');
    }

    function showGameScreen() {
      if (!selectedAnimal || !selectedDifficulty) return;
      document.getElementById('welcomeScreen').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      document.getElementById('gameOver').style.display = 'none';
      correctSound.play().then(() => correctSound.pause()).catch(e => {});
      wrongSound.play().then(() => wrongSound.pause()).catch(e => {});
      currentTargetAnimal = selectedAnimal;
      document.getElementById('targetAnimal').textContent = currentTargetAnimal.emoji;
      document.getElementById('targetPoints').textContent = currentTargetAnimal.points;
      document.getElementById('timeLeft').textContent = config.difficulties[selectedDifficulty].time;
      startGame();
    }

    function startGame() {
      gameStarted = true;
      score = 0;
      timeLeft = config.difficulties[selectedDifficulty].time;
      activeAnimals = [];
      updateDisplay();
      createHoles();
      startTimer();
      const difficultyConfig = config.difficulties[selectedDifficulty];
      clearInterval(animalInterval);
      setTimeout(() => {
        showMultipleAnimals();
        animalInterval = setInterval(showMultipleAnimals, difficultyConfig.animalSpeed);
      }, 500);
    }

    function createHoles() {
      const container = document.getElementById('holesContainer');
      container.innerHTML = '';
      for (let i = 0; i < 6; i++) {
        const hole = document.createElement('div');
        hole.className = 'hole';
        hole.dataset.index = i;
        const animal = document.createElement('div');
        animal.className = 'animal';
        animal.textContent = '?';
        hole.appendChild(animal);
        hole.addEventListener('click', () => hitAnimal(hole));
        container.appendChild(hole);
      }
    }

    function showMultipleAnimals() {
      if (!gameStarted) return;
      const holes = document.querySelectorAll('.hole');
      const availableHoles = Array.from(holes).filter(hole =>
        !hole.querySelector('.animal').classList.contains('pop-up')
      );
      if (availableHoles.length === 0) return;
      const difficultyConfig = config.difficulties[selectedDifficulty];
      const numberOfAnimals = Math.min(difficultyConfig.charactersAtOnce, availableHoles.length);
      const randomHoles = [];
      while (randomHoles.length < numberOfAnimals && availableHoles.length > 0) {
        const randomIndex = Math.floor(Math.random() * availableHoles.length);
        randomHoles.push(availableHoles[randomIndex]);
        availableHoles.splice(randomIndex, 1);
      }
      randomHoles.forEach(hole => {
        const animalElement = hole.querySelector('.animal');
        let animalToShow;
        if (Math.random() < 0.3) {
          animalToShow = currentTargetAnimal;
        } else {
          const otherAnimals = config.animals.filter(a => a.emoji !== currentTargetAnimal.emoji);
          animalToShow = otherAnimals[Math.floor(Math.random() * otherAnimals.length)];
        }
        animalElement.textContent = animalToShow.emoji;
        animalElement.dataset.animalType = animalToShow.emoji;
        animalElement.classList.add('pop-up');
        activeAnimals.push(animalElement);
        setTimeout(() => {
          if (animalElement.classList.contains('pop-up')) {
            hideAnimal(animalElement);
          }
        }, difficultyConfig.animalVisible);
      });
    }

    function hideAnimal(animalElement) {
      animalElement.classList.remove('pop-up', 'hit', 'wrong');
      animalElement.textContent = '?';
      activeAnimals = activeAnimals.filter(a => a !== animalElement);
    }

    function hitAnimal(hole) {
      if (!gameStarted) return;
      const animalElement = hole.querySelector('.animal');
      if (animalElement.classList.contains('pop-up') && !animalElement.classList.contains('hit')) {
        const animalType = animalElement.dataset.animalType;
        if (animalType === currentTargetAnimal.emoji) {
          animalElement.classList.add('hit');
          score += currentTargetAnimal.points;
          correctSound.play();
        } else {
          animalElement.classList.add('wrong');
          score = Math.max(0, score - 3);
          wrongSound.play();
        }
        updateDisplay();
        setTimeout(() => hideAnimal(animalElement), 400);
      }
    }

    function updateDisplay() {
      document.getElementById('score').textContent = score;
      document.getElementById('timeLeft').textContent = timeLeft;
    }

    function startTimer() {
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        updateDisplay();
        if (timeLeft <= 0) endGame();
      }, 1000);
    }

    function stopGame() {
      gameStarted = false;
      clearInterval(timer);
      clearInterval(animalInterval);
      activeAnimals.forEach(hideAnimal);
    }

    function endGame() {
      stopGame();
      gamesPlayed++;
      const finalScore = document.getElementById('finalScore');
      const gameMessage = document.getElementById('gameMessage');
      
      finalScore.textContent = score;
      if (score >= 100) {
        gameMessage.textContent = 'ğŸ‰ Î•Î¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬! Î Î¿Î»Î»Î¿ÏÏ‚ ÏƒÏ„ÏŒÏ‡Î¿Ï…Ï‚ Î²ÏÎ®ÎºÎµÏ‚!';
      } else if (score >= 50) {
        gameMessage.textContent = 'ğŸ‘ Î Î¿Î»Ï ÎºÎ±Î»Î¬! Î£Ï…Î½ÎµÏ‡Î¯ÏƒÏ„Îµ Î­Ï„ÏƒÎ¹!';
      } else {
        gameMessage.textContent = 'ğŸ’ª ÎšÎ±Î»Î® Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î±! ÎŒÎ»Î¿ ÎºÎ±Î¹ ÎºÎ±Î»ÏÏ„ÎµÏÎ±!';
      }

      document.getElementById('gameOver').style.display = 'flex';
    }

    function restartGame() {
      document.getElementById('gameOver').style.display = 'none';
      startGame();
    }
    
    // Initialize
    window.addEventListener('DOMContentLoaded', function() {
      initializeDropdowns();
      initializeAdBanner();
    });
    document.getElementById('startGameBtn').addEventListener('click', showGameScreen);
    // Touch optimizations
    document.addEventListener('touchstart', (e) => {
      if (e.touches.length > 1) e.preventDefault();
    });
  </script>
</body>

</html>
